function t(t,i,e,o){var n;if("group"==i)n=t.add(i,void 0,o);else if("progressbar"==i)n=t.add(i,void 0,void 0,void 0,o);else if("scrollbar"==i||"slider"==i)n=t.add(i,void 0,void 0,void 0,void 0,o);else n=t.add(i,void 0,void 0,o);var s=n;if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))s[r]=e[r];return s}function i(t){for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];for(var o=0,n=i;o<n.length;o++){var s=n[o];t.add("item",s)}return t.selection=0,t}var e={orientation:"column",alignment:"left",alignChildren:"left",spacing:2,margins:[10,5,10,0]},o=function(i){this.parent=i,this.tab=t(this.parent.tabs,"tab",{text:"空对象"}),this.group=t(this.tab,"group",e),this.pitch=t(this.group,"checkbox",{text:"音高"}),this.velocity=t(this.group,"checkbox",{text:"力度"}),this.duration=t(this.group,"checkbox",{text:"持续时间"}),this.scale=t(this.group,"checkbox",{text:"缩放"}),this.cwRotation=t(this.group,"checkbox",{text:"顺时针旋转"}),this.count=t(this.group,"checkbox",{text:"计数"}),this.bool=t(this.group,"checkbox",{text:"布尔"}),this.timeRemap=t(this.group,"checkbox",{text:"时间重映射（拉伸）"}),this.timeRemap2=t(this.group,"checkbox",{text:"时间重映射（截断）"})},n=function(i){this.parent=i,this.tab=t(this.parent.tabs,"tab",{text:"应用效果"}),this.group=t(this.tab,"group",e),this.timeRemap=t(this.group,"checkbox",{text:"时间重映射"}),this.hFlip=t(this.group,"checkbox",{text:"水平翻转"}),this.cwRotation=t(this.group,"checkbox",{text:"顺时针旋转"})},s=function(){function e(e){var o=this;this.parent=e,this.group=t(this.parent.toolsPanel,"group",{orientation:"column",alignment:["fill","fill"],alignChildren:"fill",spacing:2});var n=["fill","center"];this.bpmGroup=this.addGroup(),this.bpmLbl=this.addLabel(this.bpmGroup,"BPM"),this.bpmTxt=t(this.bpmGroup,"edittext",{text:"120",alignment:n}),this.beatGroup=this.addGroup(),this.beatLbl=this.addLabel(this.beatGroup,"节拍"),this.beatTxt=t(this.beatGroup,"edittext",{text:"4",alignment:n}),this.markOnGroup=this.addGroup(),this.markOnLbl=this.addLabel(this.markOnGroup,"标记在"),this.markOnCombo=t(this.markOnGroup,"dropdownlist",{alignment:n}),i(this.markOnCombo,"新建空对象图层","当前图层"),this.startTimeGroup=this.addGroup(),this.startTimeLbl=this.addLabel(this.startTimeGroup,"开始位置"),this.startTimeCombo=t(this.startTimeGroup,"dropdownlist",{alignment:n}),i(this.startTimeCombo,"显示开始时间","当前时间","工作区域","0"),this.beatTxt.onChange=function(){o.beatTxt.text=o.beatTxt.text.replace(/[^\d]/g,"")},this.bpmTxt.onChange=function(){var t=o.bpmTxt.text.replace(/[^\d\.]/g,"").replace(/\.+/g,".").replace(/\.$/g,""),i=t.match(/\d+\.\d+/g);if(i)t=i[0];t=t.replace(/^\./g,"0."),o.bpmTxt.text=t}}return e.prototype.addGroup=function(){return t(this.group,"group",{orientation:"row",spacing:7,alignment:"fill",alignChildren:"fill"})},e.prototype.addLabel=function(i,e){var o=t(i,"statictext",{text:e});return h(o),o},e}(),r=function(i){this.parent=i,this.tab=t(this.parent.tabs,"tab",{text:"工具"}),this.group=t(this.tab,"group",{orientation:"column",alignment:"fill",alignChildren:"fill",margins:[10,5,0,0]}),this.toolsCombo=t(this.group,"dropdownlist"),this.toolsCombo.add("item","标记生成"),this.toolsCombo.selection=0,this.toolsPanel=t(this.group,"group",{alignment:"fill",alignChildren:"fill"}),this.marker=new s(this)};var a=function(){function e(){if(this.window=new Window("dialog","设置",void 0,{resizeable:!1}),null===this.window)throw new Error("无法找到或创建窗口。");this.group=t(this.window,"group",{orientation:"column",alignChildren:"fill",alignment:"fill"}),this.aboutLbl=t(this.group,"statictext",{text:"读取一个 MIDI 序列，并为当前合成添加一个或多个新图层，其中包含各个 MIDI 轨道的音高、力度和持续时间等滑块控件。"},{multiline:!0}),this.languageGroup=t(this.group,"group",{orientation:"row"}),this.languageLbl=t(this.languageGroup,"statictext",{text:"语言"}),this.langugaeCombo=t(this.languageGroup,"dropdownlist"),i(this.langugaeCombo,"简体中文","English","日本語"),this.usingSelectedLayerName=t(this.group,"checkbox",{text:"使用选择图层名称而不是轨道名称"}),this.okBtn=t(this.group,"button",{text:"确定(&O)"}),this.window.defaultElement=this.okBtn}return e.prototype.show=function(){this.window.center(),this.window.show()},e}(),l=function(){function i(i){var e=this;this.window=i,this.group=t(this.window,"group",{orientation:"column",alignChildren:"fill",alignment:"fill"});var s={orientation:"row",spacing:7};this.selectMidiGroup=t(this.group,"group",s),this.selectMidiLbl=t(this.selectMidiGroup,"statictext",{text:"MIDI 文件"}),h(this.selectMidiLbl),this.selectMidiBtn=t(this.selectMidiGroup,"button",{text:"...",bounds:[0,0,15,22]}),this.selectMidiName=t(this.selectMidiGroup,"statictext",{text:"未选择",alignment:["fill","center"]}),this.selectTrackGroup=t(this.group,"group",s),this.selectTrackLbl=t(this.selectTrackGroup,"statictext",{text:"选择轨道"}),h(this.selectTrackLbl),this.selectTrackBtn=t(this.selectTrackGroup,"button",{text:"",alignment:["fill","center"],maximumSize:[Number.MAX_VALUE,22]}),this.tabs=t(this.group,"tabbedpanel",{alignment:["fill","fill"]}),this.buttonGroup=t(this.group,"group",{orientation:"row",alignment:["fill","bottom"]}),this.applyBtn=t(this.buttonGroup,"button",{text:"应用(&A)",alignment:"left"}),this.settingBtn=t(this.buttonGroup,"button",{text:"设置(&S)",alignment:["right","center"]}),this.selectMidiBtn.onClick=function(){var t=File.openDialog("选择一个 MIDI 序列","MIDI 序列:*.mid;*.midi,所有文件:*.*");if(e.selectMidiName)e.selectMidiName.text=t.displayName},this.applyBtn.onClick=function(){var t=function(){var t=app.project.activeItem;if(!isValid(t))return null;else return t}();if(null!==t){t.layers.addNull(1e4).name="fuck"}},this.settingBtn.onClick=function(){(new a).show()},this.nullObjTab=new o(this),this.applyEffectsTab=new n(this),this.toolsTab=new r(this)}return i.build=function(t,e){var o=t instanceof Panel?t:new Window("palette",e.scriptName+" v"+e.version,void 0,{resizeable:!0});if(null===o)throw new Error("无法找到或创建窗口。");var n=new i(o);if(o instanceof Window)o.onResizing=o.onResize=function(){return o.layout.resize()},o.center(),o.show();else o.layout.layout(!0),o.layout.resize();return n},i}();function h(t){t.minimumSize=[60,Number.MAX_VALUE]}l.build(this,{scriptName:"om_midi",version:"3.0"});
