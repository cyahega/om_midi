/**
 * om midi v3.0
 * 简称 OMM，After Effects 的音 MAD / YTPMV 辅助脚本。它是一个能够自动将 MIDI 文件转换为 After Effects 中关键帧的脚本。
 * 希望在 om midi 的帮助下，可以把人们从枯燥繁重的音画对齐中解救出来，把更多的精力投入到更有创造性的工作中。
 *
 * 描述：读取一个 MIDI 序列，并为当前合成添加一个或多个新图层，其中包含各个 MIDI 轨道的音高、力度和持续时间等滑块控件。
 *
 * 脚本原作者：大卫·范·布林克 (omino)、Dora (NGDXW)、韩琦、家鳖大帝
 * 脚本作者：兰音
 *
 * 在此处获取最新版：https://github.com/otomad/om_midi/releases/latest
 * 仓库地址：https://github.com/otomad/om_midi
 *
 * 构建日期：2022 年 9 月 5 日 星期一 下午 14:39:44
 * Copyright (c) 2022 ~, Ranne
 *
 * 原作者介绍：
 * 日期：2011 年 12 月 25 日 星期日 晚上 22:58:10 太平洋时间
 * 作者：大卫·范·布林克
 *
 * 此脚本是 omino Adobe 脚本套件的一部分。
 * 我写这些是因为我喜欢。请尽情享受。
 * 向 poly@omino.com 提出问题，主题行应以“插件”开头，以便我的垃圾邮件过滤器允许它。
 * 此文件已被预处理为独立脚本。我针对一些可重用的库开发它们⸺例如对话框布局⸺但对于分发来说，最好只有一个文件。
 * 大卫·范·布林克 2007。
 *
 * ****************************************************************************************************
 *
 * om midi v3.0
 * Or OMM for short, an Otomad/YTPMV assistant script for After Effects. It is a script that automatically
 * converts MIDI files to keyframes in After Effects. Hope that with the help of om midi, people can be
 * rescued from tedious aligning video and audio, and put more energy into more creative works.
 *
 * Description: This After Effects script reads a Standard MIDI file (.mid)
 * and creates layers and keyframes corresponding to the notes and controllers in that MIDI file.
 *
 * Script Original Authors: David Van Brink (omino), Dora (NGDXW), HanceyMica, Z4HD
 * Script Author: Ranne
 *
 * Get the Latest Version Here: https://github.com/otomad/om_midi/releases/latest
 * Repository Link: https://github.com/otomad/om_midi
 *
 * Building Date: Monday, September 5, 2022 2:39 PM
 * Copyright (c) 2022 ~, Ranne
 *
 * Introduction by the Original Author:
 * Date: Sunday, December 25, 2011 10:58 PM PST
 * Author: David Van Brink
 * This script is part of the omino adobe script suite.
 *
 * I write these because I like to. Please enjoy as you see fit.
 *
 * Questions to poly@omino.com, subject line should start with "plugins" so my spam filter lets it in.
 *
 * This file has been preprocessed to be standalone. I develop them against some reusable libraries
 * ⸺ such as for dialog layout ⸺ but for distribution it's nicer to have just one file.
 * dvb 2007.
 */

!function(t){var e={scriptName:"om midi",version:"3.0",githubPage:"https://github.com/otomad/om_midi",githubLatest:"https://github.com/otomad/om_midi/releases/latest"};function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function i(t,e,i,r){var o;if("group"==e)o=t.add(e,void 0,r);else if("progressbar"==e)o=t.add(e,void 0,void 0,void 0,r);else if("scrollbar"==e||"slider"==e)o=t.add(e,void 0,void 0,void 0,void 0,r);else o=t.add(e,void 0,void 0,r);var a=o;if(null!=i)for(var l in i)if(n(i,l))a[l]=i[l];return a}function r(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0,r=e;i<r.length;i++){var o=r[i];t.add("item",o)}return t.selection=0,t}function o(t,e,n,r,o){var a=i(t,"group",{orientation:"row",spacing:7,alignment:"fill",alignChildren:"fill"}),l=function(t,e){var n=i(t,"statictext",{text:e});return function(t){t.minimumSize=[60,Number.MAX_VALUE]}(n),n}(a,e),s=void 0;if(n)s=i(a,n,r,o);return{group:a,label:l,control:s}}var a=function(t,e){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n))t[n]=e[n]},a(t,e)};function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function s(t,e,n){if(n||2===arguments.length)for(var i,r=0,o=e.length;r<o;r++)if(i||!(r in e)){if(!i)i=Array.prototype.slice.call(e,0,r);i[r]=e[r]}return t.concat(i||Array.prototype.slice.call(e))}var u={ok:"OK",cancel:"Cancel",channel_abbr:"CH",error:"Error",warning:"Warning",apply:"Apply",settings:"Settings",select_all:"Select all",channel:"Channel",name:"name",note_count:"Note count",language:"Langugae",general:"General",app_default:"App Default",tools:"Tools",create_null_object_short:"Null",create_null_object:"Create Null Object",apply_effects_short:"Effects",apply_effects:"Apply Effects"},c={ok:"OK",cancel:"キャンセル",channel_abbr:"チャネル",error:"エラー",warning:"警告",apply:"適用",settings:"設定",select_all:"すべて選択",channel:"チャネル",name:"名",note_count:"音符の数",language:"言語",general:"一般",app_default:"アプリのデフォルト",tools:"ツール",create_null_object_short:"ヌル",create_null_object:"ヌル オブジェクトを作成",apply_effects_short:"効果を適用",apply_effects:"効果を適用"},p={ok:"确定",cancel:"取消",channel_abbr:"通道",error:"错误",warning:"警告",apply:"应用",settings:"设置",select_all:"全选",channel:"通道",name:"名称",note_count:"音符数",language:"语言",general:"通用",app_default:"应用默认值",tools:"工具",create_null_object_short:"空对象",create_null_object:"创建空对象",apply_effects_short:"应用效果",apply_effects:"应用效果"},h={};for(var f in p)if(n(p,f))h[f]={zh:p[f],en:u[f],ja:c[f]};var E,d={orientation:"column",alignment:"left",alignChildren:"left",spacing:2,margins:[10,5,10,0]},_=function(){function t(t,e,n){if(void 0===n)n=d;this.parent=t,this.tab=i(this.parent.tabs,"tab",{text:e}),this.group=i(this.tab,"group",n)}return t.prototype.getCheckedChecks=function(){for(var t=[],e=0,n=this.group.children;e<n.length;e++){var i=n[e];if(i instanceof Checkbox&&i.value)t.push(i)}return t},t.prototype.addCheckbox=function(t){return i(this.group,"checkbox",{text:t})},t}(),O=function(t){function e(e){var n=t.call(this,e)||this;return n.pitch=n.addCheckbox("音高"),n.velocity=n.addCheckbox("力度"),n.duration=n.addCheckbox("持续时间"),n.scale=n.addCheckbox("缩放"),n.cwRotation=n.addCheckbox("顺时针旋转"),n.ccwRotation=n.addCheckbox("逆时针旋转"),n.count=n.addCheckbox("计数"),n.bool=n.addCheckbox("布尔"),n.timeRemap=n.addCheckbox("时间重映射"),n.pingpong=n.addCheckbox("来回"),n.noteOn=n.addCheckbox("音符开"),n.pan=n.addCheckbox("通道声像"),n.volume=n.addCheckbox("通道音量"),n.glide=n.addCheckbox("通道弯音"),n}return l(e,t),e.prototype.translate=function(){this.tab.text=localize(h.create_null_object_short)},e}(_),T=function(t){function e(e){var n,a=t.call(this,e)||this;return a.timeRemap=a.addCheckbox("时间重映射（拉伸）"),a.timeRemap2=a.addCheckbox("时间重映射（截断）"),a.pingpong=a.addCheckbox("来回"),a.hFlip=a.addCheckbox("水平翻转"),a.cwRotation=a.addCheckbox("顺时针旋转"),a.ccwRotation=a.addCheckbox("逆时针旋转"),a.negative=a.addCheckbox("颜色反转"),a.tuning=a.addCheckbox("调音"),n=o(a.group,"原始音高","dropdownlist"),a.basePitchGroup=n.group,a.basePitchLbl=n.label,a.basePitchKeyCombo=n.control,a.basePitchOctCombo=i(a.basePitchGroup,"dropdownlist"),r.apply(void 0,s([a.basePitchKeyCombo],"C,C#,D,D#,E,F,F#,G,G#,A,A#,B".split(","))),r.apply(void 0,s([a.basePitchOctCombo],"0,1,2,3,4,5,6,7,8,9,10".split(","))),a.basePitchOctCombo.selection=5,a.basePitchGroup.enabled=!1,a.tuning.onClick=function(){return a.basePitchGroup.enabled=a.tuning.value},a.cwRotation.onClick=function(){return a.ccwRotation.value=!1},a.ccwRotation.onClick=function(){return a.cwRotation.value=!1},a.timeRemap.onClick=function(){return a.timeRemap2.value=a.pingpong.value=!1},a.timeRemap2.onClick=function(){return a.timeRemap.value=a.pingpong.value=!1},a.pingpong.onClick=function(){return a.timeRemap.value=a.timeRemap2.value=!1},a}return l(e,t),e.prototype.translate=function(){this.tab.text=localize(h.apply_effects_short)},e}(_);function R(t,e,n){t.onChange=function(){var i=t.text,r=/\d+/g;if(e===E.POSITIVE_DECIMAL)r=/\d+(\.\d+)?/g;else if(e===E.DECIMAL)r=/-?\d+(\.\d+)?/g;var o=i.match(r);if(o){(i=o[0].replace(/^0+(?!\.)/g,""))||(i="0");var a=e==E.POSITIVE_INT?parseInt(i,10):parseFloat(i);i=String(e!==E.DECIMAL&&a<=0||isNaN(a)?n:a)}else i=String(n);t.text=i}}!function(t){t[t.POSITIVE_INT=0]="POSITIVE_INT",t[t.POSITIVE_DECIMAL=1]="POSITIVE_DECIMAL",t[t.DECIMAL=2]="DECIMAL"}(E||(E={}));var m=function(t){this.parent=t,this.group=i(this.parent.toolsPanel,"group",{orientation:"column",alignment:["fill","fill"],alignChildren:"fill",spacing:2})},g=function(t){function e(e){var n,i,a,l,s=t.call(this,e)||this,u=["fill","center"];return n=o(s.group,"单位","dropdownlist",{alignment:u}),s.unitGroup=n.group,s.unitLbl=n.label,s.unitCombo=n.control,r(s.unitCombo,"BPM","时间","帧数"),i=o(s.group,"BPM","edittext",{text:"120",alignment:u}),s.bpmGroup=i.group,s.bpmLbl=i.label,s.bpmTxt=i.control,a=o(s.group,"节拍","edittext",{text:"4",alignment:u}),s.beatGroup=a.group,s.beatLbl=a.label,s.beatTxt=a.control,l=o(s.group,"标记在","dropdownlist",{alignment:u}),s.markOnGroup=l.group,s.markOnLbl=l.label,s.markOnCombo=l.control,r(s.markOnCombo,"新建空对象图层","当前图层"),R(s.bpmTxt,E.POSITIVE_DECIMAL,120),s.unitCombo.onChange=function(){var t=s.unitCombo.getSelectedIndex();s.beatLbl.text=0===t?"节拍":"偏移",s.bpmLbl.text=0===t?"BPM":1===t?"秒数":"帧数",R(s.beatTxt,0===t?E.POSITIVE_INT:E.DECIMAL,4),s.beatTxt.notify("onChange")},s.unitCombo.notify("onChange"),s}return l(e,t),e}(m),L=function(t,e){this.control=t.add("panel"),this.control.alignment="horizontal"===e?["fill","top"]:["center","fill"]},S=function(t){function e(n){if(!(n instanceof e))alert(n.toString(),localize(h.error),!0);return t.call(this,n.toString())||this}return l(e,t),e}(Error),C=function(t){function e(){return t.call(this,"错误：无法找到或创建窗口。")||this}return l(e,t),e}(S),v=function(t){function e(){return t.call(this,"错误：不支持的设置数据类型。")||this}return l(e,t),e}(S),N=function(t){function e(){return t.call(this,"错误：无法读取 MIDI 文件。该文件可能已占用或不存在。")||this}return l(e,t),e}(S),y=function(t){function e(){return t.call(this,"错误：MIDI 文件头验证失败（不是标准 MIDI 文件或文件已损坏）。")||this}return l(e,t),e}(S),b=function(t){function e(){return t.call(this,"错误：MIDI 轨道块标头验证失败。")||this}return l(e,t),e}(S),A=function(t){function e(){return t.call(this,"错误：自定义 MIDI 事件无法读取。")||this}return l(e,t),e}(S),I=function(t){function e(){return t.call(this,"错误：该 MIDI 文件不包含任何有效轨道。")||this}return l(e,t),e}(S),w=function(t){function e(){return t.call(this,"错误：请在 Adobe After Effects 上使用此脚本。")||this}return l(e,t),e}(S),P=function(t){function e(){return t.call(this,"错误：无法创建文件。")||this}return l(e,t),e}(S),k=function(t){function e(){return t.call(this,"错误：无法找到活动合成。请先激活一个合成。")||this}return l(e,t),e}(S),D=function(t){function e(){return t.call(this,"错误：请先打开一个有效的 MIDI 文件。")||this}return l(e,t),e}(S),B=function(t){function e(){return t.call(this,"错误：请至少勾选一个项目。")||this}return l(e,t),e}(S),M=function(t){function e(){return t.call(this,"错误：在当前合成中未选中任何图层。")||this}return l(e,t),e}(S),F=function(t){function e(){return t.call(this,"错误：应用效果只能同时选择一条轨道。")||this}return l(e,t),e}(S),x=function(t){function e(e,n){return t.call(this,"错误：轨道结束位置有误。应为 "+e+"，实际 "+n)||this}return l(e,t),e}(S),G=function(t){function e(){return t.call(this,"错误：所选图层不能设置时间重映射。")||this}return l(e,t),e}(S),U=function(t){function e(){return t.call(this,"错误：所选图层不包含音频，不能进行调音。")||this}return l(e,t),e}(S);var K,H,z,V,j="om_midi",Y=function(t,e){if(!app.settings.haveSetting(j,t))return e;else{var n=app.settings.getSetting(j,t),i=void 0;if("string"==typeof e)i=n;else if("number"==typeof e)i=Number(n);else if("boolean"==typeof e)i="0"!==n;else throw new v;return i}},X=function(t,e){var n=e;if("boolean"==typeof e)n=n?"1":"0";app.settings.saveSetting(j,t,n.toString())},Q={Language:0,UsingSelectedLayerName:!1,UsingLayering:!1,OptimizeApplyEffects:!0,NormalizePanTo100:!0,AddToEffectTransform:!1,ApplyEffectsStartTime:1,NullObjectStartTime:0,LastTool:0},W={},q=function(t){if(n(Q,t))W["get"+t]=function(e){if(void 0===e)e=Q[t];return Y(t,e)},W["set"+t]=function(e){return X(t,e)}};for(var Z in Q)q(Z);!function(t){t[t.SINGLE_TRACK=0]="SINGLE_TRACK",t[t.SYNC_MULTI_TRACK=1]="SYNC_MULTI_TRACK",t[t.ASYNC_MULTI_TRACK=2]="ASYNC_MULTI_TRACK"}(K||(K={})),function(t){t[t.END_OF_TRACK=47]="END_OF_TRACK",t[t.END_OF_FILE=-1]="END_OF_FILE",t[t.TEXT_EVENT=1]="TEXT_EVENT",t[t.COPYRIGHT_NOTICE=2]="COPYRIGHT_NOTICE",t[t.TRACK_NAME=3]="TRACK_NAME",t[t.INSTRUMENT_NAME=4]="INSTRUMENT_NAME",t[t.LYRICS=5]="LYRICS",t[t.MARKER=6]="MARKER",t[t.CUE_POINT=7]="CUE_POINT",t[t.MIDI_PORT=33]="MIDI_PORT",t[t.MIDI_PORT_2=32]="MIDI_PORT_2",t[t.SET_TEMPO=81]="SET_TEMPO",t[t.KEY_SIGNATURE=89]="KEY_SIGNATURE",t[t.SMPTE_OFFSET=84]="SMPTE_OFFSET",t[t.TIME_SIGNATURE=88]="TIME_SIGNATURE",t[t.SEQUENCER_SPECIFIC=127]="SEQUENCER_SPECIFIC"}(H||(H={})),function(t){t[t.SYSTEM_EXCLUSIVE_EVENTS=15]="SYSTEM_EXCLUSIVE_EVENTS",t[t.NOTE_AFTERTOUCH=10]="NOTE_AFTERTOUCH",t[t.CONTROLLER=11]="CONTROLLER",t[t.PITCH_BEND_EVENT=14]="PITCH_BEND_EVENT",t[t.NOTE_OFF=8]="NOTE_OFF",t[t.NOTE_ON=9]="NOTE_ON",t[t.PROGRAM_CHANGE=12]="PROGRAM_CHANGE",t[t.CHANNEL_AFTERTOUCH=13]="CHANNEL_AFTERTOUCH",t[t.END_OF_FILE=-1]="END_OF_FILE"}(z||(z={})),function(t){t[t.BANK_SELECT=0]="BANK_SELECT",t[t.MODULATION=1]="MODULATION",t[t.BREATH_CONTROLLER=2]="BREATH_CONTROLLER",t[t.FOOT_CONTROLLER=4]="FOOT_CONTROLLER",t[t.PORTAMENTO_TIME=5]="PORTAMENTO_TIME",t[t.DATA_ENTRY=6]="DATA_ENTRY",t[t.MAIN_VOLUME=7]="MAIN_VOLUME",t[t.BALANCE=8]="BALANCE",t[t.PAN=10]="PAN",t[t.EXPRESSION_CONTROLLER=11]="EXPRESSION_CONTROLLER",t[t.EFFECT_CONTROL_1=12]="EFFECT_CONTROL_1",t[t.EFFECT_CONTROL_2=13]="EFFECT_CONTROL_2",t[t.GENERAL_PURPOSE_CONTROLLERS_1=16]="GENERAL_PURPOSE_CONTROLLERS_1",t[t.GENERAL_PURPOSE_CONTROLLERS_2=17]="GENERAL_PURPOSE_CONTROLLERS_2",t[t.GENERAL_PURPOSE_CONTROLLERS_3=18]="GENERAL_PURPOSE_CONTROLLERS_3",t[t.GENERAL_PURPOSE_CONTROLLERS_4=19]="GENERAL_PURPOSE_CONTROLLERS_4",t[t.LSB_FOR_CONTROLLERS_0=32]="LSB_FOR_CONTROLLERS_0",t[t.LSB_FOR_CONTROLLERS_1=33]="LSB_FOR_CONTROLLERS_1",t[t.LSB_FOR_CONTROLLERS_2=34]="LSB_FOR_CONTROLLERS_2",t[t.LSB_FOR_CONTROLLERS_3=35]="LSB_FOR_CONTROLLERS_3",t[t.LSB_FOR_CONTROLLERS_4=36]="LSB_FOR_CONTROLLERS_4",t[t.LSB_FOR_CONTROLLERS_5=37]="LSB_FOR_CONTROLLERS_5",t[t.LSB_FOR_CONTROLLERS_6=38]="LSB_FOR_CONTROLLERS_6",t[t.LSB_FOR_CONTROLLERS_7=39]="LSB_FOR_CONTROLLERS_7",t[t.LSB_FOR_CONTROLLERS_8=40]="LSB_FOR_CONTROLLERS_8",t[t.LSB_FOR_CONTROLLERS_9=41]="LSB_FOR_CONTROLLERS_9",t[t.LSB_FOR_CONTROLLERS_10=42]="LSB_FOR_CONTROLLERS_10",t[t.LSB_FOR_CONTROLLERS_11=43]="LSB_FOR_CONTROLLERS_11",t[t.LSB_FOR_CONTROLLERS_12=44]="LSB_FOR_CONTROLLERS_12",t[t.LSB_FOR_CONTROLLERS_13=45]="LSB_FOR_CONTROLLERS_13",t[t.LSB_FOR_CONTROLLERS_14=46]="LSB_FOR_CONTROLLERS_14",t[t.LSB_FOR_CONTROLLERS_15=47]="LSB_FOR_CONTROLLERS_15",t[t.LSB_FOR_CONTROLLERS_16=48]="LSB_FOR_CONTROLLERS_16",t[t.LSB_FOR_CONTROLLERS_17=49]="LSB_FOR_CONTROLLERS_17",t[t.LSB_FOR_CONTROLLERS_18=50]="LSB_FOR_CONTROLLERS_18",t[t.LSB_FOR_CONTROLLERS_19=51]="LSB_FOR_CONTROLLERS_19",t[t.LSB_FOR_CONTROLLERS_20=52]="LSB_FOR_CONTROLLERS_20",t[t.LSB_FOR_CONTROLLERS_21=53]="LSB_FOR_CONTROLLERS_21",t[t.LSB_FOR_CONTROLLERS_22=54]="LSB_FOR_CONTROLLERS_22",t[t.LSB_FOR_CONTROLLERS_23=55]="LSB_FOR_CONTROLLERS_23",t[t.LSB_FOR_CONTROLLERS_24=56]="LSB_FOR_CONTROLLERS_24",t[t.LSB_FOR_CONTROLLERS_25=57]="LSB_FOR_CONTROLLERS_25",t[t.LSB_FOR_CONTROLLERS_26=58]="LSB_FOR_CONTROLLERS_26",t[t.LSB_FOR_CONTROLLERS_27=59]="LSB_FOR_CONTROLLERS_27",t[t.LSB_FOR_CONTROLLERS_28=60]="LSB_FOR_CONTROLLERS_28",t[t.LSB_FOR_CONTROLLERS_29=61]="LSB_FOR_CONTROLLERS_29",t[t.LSB_FOR_CONTROLLERS_30=62]="LSB_FOR_CONTROLLERS_30",t[t.LSB_FOR_CONTROLLERS_31=63]="LSB_FOR_CONTROLLERS_31",t[t.DAMPER_PEDAL=64]="DAMPER_PEDAL",t[t.PORTAMENTO=65]="PORTAMENTO",t[t.SOSTENUTO=66]="SOSTENUTO",t[t.SOFT_PEDAL=67]="SOFT_PEDAL",t[t.LEGATO_FOOTSWITCH=68]="LEGATO_FOOTSWITCH",t[t.HOLD_2=69]="HOLD_2",t[t.SOUND_CONTROLLER_1=70]="SOUND_CONTROLLER_1",t[t.SOUND_CONTROLLER_2=71]="SOUND_CONTROLLER_2",t[t.SOUND_CONTROLLER_3=72]="SOUND_CONTROLLER_3",t[t.SOUND_CONTROLLER_4=73]="SOUND_CONTROLLER_4",t[t.SOUND_CONTROLLER_5=74]="SOUND_CONTROLLER_5",t[t.SOUND_CONTROLLER_6=75]="SOUND_CONTROLLER_6",t[t.SOUND_CONTROLLER_7=76]="SOUND_CONTROLLER_7",t[t.SOUND_CONTROLLER_8=77]="SOUND_CONTROLLER_8",t[t.SOUND_CONTROLLER_9=78]="SOUND_CONTROLLER_9",t[t.SOUND_CONTROLLER_10=79]="SOUND_CONTROLLER_10",t[t.GENERAL_PURPOSE_CONTROLLERS_5=80]="GENERAL_PURPOSE_CONTROLLERS_5",t[t.GENERAL_PURPOSE_CONTROLLERS_6=81]="GENERAL_PURPOSE_CONTROLLERS_6",t[t.GENERAL_PURPOSE_CONTROLLERS_7=82]="GENERAL_PURPOSE_CONTROLLERS_7",t[t.GENERAL_PURPOSE_CONTROLLERS_8=83]="GENERAL_PURPOSE_CONTROLLERS_8",t[t.PORTAMENTO_CONTROL=84]="PORTAMENTO_CONTROL",t[t.EFFECTS_1_DEPTH=91]="EFFECTS_1_DEPTH",t[t.EFFECTS_2_DEPTH=92]="EFFECTS_2_DEPTH",t[t.EFFECTS_3_DEPTH=93]="EFFECTS_3_DEPTH",t[t.EFFECTS_4_DEPTH=94]="EFFECTS_4_DEPTH",t[t.EFFECTS_5_DEPTH=95]="EFFECTS_5_DEPTH",t[t.DATA_INCREMENT=96]="DATA_INCREMENT",t[t.DATA_DECREMENT=97]="DATA_DECREMENT",t[t.NON_REGISTERED_PARAMETER_NUMBER_LSB=98]="NON_REGISTERED_PARAMETER_NUMBER_LSB",t[t.NON_REGISTERED_PARAMETER_NUMBER_MSB=99]="NON_REGISTERED_PARAMETER_NUMBER_MSB",t[t.REGISTERED_PARAMETER_NUMBER_LSB=100]="REGISTERED_PARAMETER_NUMBER_LSB",t[t.REGISTERED_PARAMETER_NUMBER_MSB=101]="REGISTERED_PARAMETER_NUMBER_MSB",t[t.MODE_MESSAGES_1=121]="MODE_MESSAGES_1",t[t.MODE_MESSAGES_2=122]="MODE_MESSAGES_2",t[t.MODE_MESSAGES_3=123]="MODE_MESSAGES_3",t[t.MODE_MESSAGES_4=124]="MODE_MESSAGES_4",t[t.MODE_MESSAGES_5=125]="MODE_MESSAGES_5",t[t.MODE_MESSAGES_6=126]="MODE_MESSAGES_6",t[t.MODE_MESSAGES_7=127]="MODE_MESSAGES_7"}(V||(V={}));var J,tt=K,et=function(){this.deltaTime=0,this.sofarTick=0},nt=function(t){function e(e){var n=t.call(this)||this;return n.type=0,n.type=e,n}return l(e,t),e}(et),it=function(t){function e(e,n){var i=t.call(this,e)||this;return i.content=n,i}return l(e,t),e}(nt),rt=function(t){function e(e,n){var i=t.call(this,e)||this;return i.value=n,i}return l(e,t),e}(nt),ot=function(t){function e(e){var n=t.call(this,H.SMPTE_OFFSET)||this;return n.hour=e[0],n.min=e[1],n.sec=e[2],n.fr=e[3],n.subFr=e[4],n}return l(e,t),e}(nt),at=function(t){function e(e){var n=t.call(this,H.TIME_SIGNATURE)||this;return n.number=e[0],n.denom=e[1],n.metro=e[2],n.thirtySeconds=e[3],n}return l(e,t),e.prototype.toString=function(){return this.number+"/"+Math.pow(2,this.denom)},e}(nt),lt=function(t){function e(e,n){var i=t.call(this,e)||this;return i.value=n,i}return l(e,t),e}(nt),st=function(t){function e(e,n){var i=t.call(this)||this;return i.type=e,i.values=n,i}return l(e,t),e}(et),ut=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.pitch=n[0],i.velocity=n[1],i}return l(e,t),e}(st),ct=function(t){function e(e,n,i,r,o){var a=this;if(e instanceof Array)a=t.call(this,z.NOTE_ON,e)||this;else(a=t.call(this,z.NOTE_ON,[e,n])||this).deltaTime=i,a.duration=r,a.sofarTick=o;return a}return l(e,t),e}(ut),pt=function(t){function e(e){return t.call(this,z.NOTE_OFF,e)||this}return l(e,t),e}(ut),ht=function(t){function e(e){return t.call(this,z.SYSTEM_EXCLUSIVE_EVENTS,e)||this}return l(e,t),e}(st),ft=function(t){function e(e){var n=t.call(this,z.CONTROLLER,e)||this;return n.controller=e[0],n.value=e[1],n}return l(e,t),e}(st),Et=function(t){function e(n){var i=t.call(this,z.PITCH_BEND_EVENT,n)||this;return i.value=e.take7Bit(n[1])<<7|e.take7Bit(n[0]),i}return l(e,t),e.take7Bit=function(t){return 127&t},e}(st),dt=5e-4,_t="om midi null",Ot="om midi Transform",Tt=function(){function t(t){this.portal=t}return t.prototype.apply=function(){var t=function(){var t=app.project.activeItem;if(!isValid(t))return null;else return t}();if(null===t)throw new k;try{var e=this.portal.getSelectedTab();if(e===this.portal.nullObjTab)this.applyCreateNullObject(t);else if(e===this.portal.applyEffectsTab)this.applyEffects(t);else if(e===this.portal.toolsTab){var n=this.portal.toolsTab.getSelectedTool();if(n===this.portal.toolsTab.marker)this.applyMarkerConductor(t);else if(n===this.portal.toolsTab.ease)this.applyEase100Percent(t)}}catch(t){throw new S(t)}finally{app.endUndoGroup()}},t.prototype.applyCreateNullObject=function(t){var e,n,i=this;app.beginUndoGroup("om midi - Apply Create Null Object");var r=this.portal.nullObjTab;if(!this.portal.midi||0===this.portal.selectedTracks.length)throw new D;var o=r.getCheckedChecks();if(0===o.length)throw new B;var a=W.getUsingSelectedLayerName(),l=this.getSelectLayer(t);if(null===l)a=!1;for(var s=W.getNormalizePanTo100(),u=this.getSecondsPerTick(),c=this.getStartTime(t),p=function(p){if(void 0===p&&!h.portal.midi.isPureQuarter)return"continue";var f=h.createNullLayer(t);if(void 0!==p)f.name="[midi]"+(a&&null!==l?l.name:null!==(e=p.name)&&void 0!==e?e:"Channel "+(null!==(n=p.channel)&&void 0!==n?n:0));else f.name="[midi]BPM: "+h.portal.selectBpmTxt.text;f.inPoint=c,f.outPoint=void 0!==p?c+p.lengthTick*u:c+t.duration;for(var E=0,d=o;E<d.length;E++){var _=d[E];h.addSliderControl(f,_.text)}var O=function(t,e,n,r,a){return i.setValueAtTime(f,o,t,c+e,n,r,a)},T=0,R=z.NOTE_OFF,m=-1,g=NaN,L=NaN,S=NaN;h.dealNoteEvents(p,t,u,c,(function(t){var e,n;if(!(t.sofarTick<=m)||R===z.NOTE_OFF&&t instanceof ct||!(t instanceof ct||t instanceof pt)){var i=t.sofarTick*u;if(t instanceof ct){if(0===t.interruptDuration||0===t.duration||+t.interruptDuration<0||+t.duration<0)return;if(O(r.pitch,i,t.pitch,KeyframeInterpolationType.HOLD),O(r.velocity,i,t.velocity,KeyframeInterpolationType.HOLD),O(r.duration,i,null!==(e=t.duration)&&void 0!==e?e:0,KeyframeInterpolationType.HOLD),O(r.count,i,T,KeyframeInterpolationType.HOLD),O(r.bool,i,+!(T%2),KeyframeInterpolationType.HOLD),O(r.scale,i,T%2?-100:100,KeyframeInterpolationType.HOLD),O(r.cwRotation,i,T%4*90,KeyframeInterpolationType.HOLD),O(r.ccwRotation,i,(4-T%4)%4*90,KeyframeInterpolationType.HOLD),O(r.noteOn,i,1,KeyframeInterpolationType.HOLD),O(r.timeRemap,i,0,KeyframeInterpolationType.LINEAR),O(r.pingpong,i,T%2,KeyframeInterpolationType.LINEAR),void 0!==t.interruptDuration||void 0!==t.duration){var o=null!==(n=t.interruptDuration)&&void 0!==n?n:t.duration,a=(t.sofarTick+o)*u-dt;O(r.timeRemap,a,1,KeyframeInterpolationType.LINEAR,KeyframeInterpolationType.HOLD),O(r.pingpong,a,+!(T%2),KeyframeInterpolationType.LINEAR,KeyframeInterpolationType.HOLD)}T++,R=z.NOTE_ON,m=t.sofarTick}else if(t instanceof pt){a=i-dt;O(r.velocity,a,t.velocity,KeyframeInterpolationType.HOLD),O(r.noteOn,i,0,KeyframeInterpolationType.HOLD),R=z.NOTE_OFF,m=t.sofarTick}else if(t instanceof ft){var l=t.controller;if(l===V.PAN){if(g===t.value)return;g=t.value;var c=t.value-64;if(s)if(c<0)c=c/64*100;else if(c>0)c=c/63*100;O(r.pan,i,c,KeyframeInterpolationType.HOLD)}else if(l===V.MAIN_VOLUME){if(L===t.value)return;L=t.value,O(r.volume,i,t.value,KeyframeInterpolationType.HOLD)}}else if(t instanceof Et){if(S===t.value)return;S=t.value;var p=t.value-8192;O(r.glide,i,p,KeyframeInterpolationType.HOLD)}}}))},h=this,f=0,E=this.portal.selectedTracks;f<E.length;f++){p(E[f])}},t.prototype.applyMarkerConductor=function(t){app.beginUndoGroup("om midi - Apply Marker Conductor");var e,n=this.portal.toolsTab.marker;if(1===n.markOnCombo.getSelectedIndex()){var i=this.getSelectLayer(t);if(null===i)throw new M;e=i}else(e=this.createNullLayer(t)).name="BPM:"+n.bpmTxt.text+" ("+n.beatTxt.text+"/4)";var r=this.getStartTime(t);e.startTime=r;var o=1,a=n.unitCombo.getSelectedIndex();if(1===a)r+=parseFloat(n.beatTxt.text);else if(2===a)r+=parseFloat(n.beatTxt.text)*t.frameDuration;for(var l=parseFloat(n.bpmTxt.text);r<=t.displayStartTime+t.duration;)if(e.marker.setValueAtTime(r,new MarkerValue(String(o))),0===a)o=o%parseInt(n.beatTxt.text)+1,r+=60/l;else if(o++,1===a)r+=l;else if(2===a)r+=l*t.frameDuration},t.prototype.applyEffects=function(e){var n=this;app.beginUndoGroup("om midi - Apply Effects");var i=this.portal.applyEffectsTab;if(!this.portal.midi||0===this.portal.selectedTracks.length)throw new D;if(0===i.getCheckedChecks().length)throw new B;if(1!==this.portal.selectedTracks.length)throw new F;var r=1===i.getCheckedChecks().length&&i.tuning.value,o=this.getSelectLayer(e);if(null===o)throw new M;var a=o,l=this.getSecondsPerTick(),s=this.portal.selectedTracks[0],u=this.getStartTime(e),c=function(){return u-(a.inPoint-a.startTime)},p=function(){return void 0!==s?u+s.lengthTick*l:u+e.duration};if(1===this.portal.startTimeCombo.getSelectedIndex())u=a.inPoint;else if(!r)a.startTime=c();var h=W.getUsingLayering(),f=W.getOptimizeApplyEffects(),E=W.getAddToEffectTransform();if(a.timeRemapEnabled)a.timeRemapEnabled=!1;var d=a.source,_=(+(d.duration/d.frameDuration).toFixed(0)-1)*d.frameDuration,O=a.outPoint-a.inPoint-d.frameDuration,T=0,R={prop:function(){return t.getEffects(a).property(T)},scaleTogether:function(){return this.prop().property(3)},scaleHeight:function(){return this.prop().property(4)},scaleWidth:function(){return this.prop().property(5)},rotation:function(){return this.prop().property(8)}};if(i.hFlip.value||i.cwRotation.value||i.ccwRotation.value){if(i.hFlip.value)a.scale.expressionEnabled=!1;else if(i.cwRotation.value||i.ccwRotation.value)a.rotation.expressionEnabled=!1;if(E)T=this.getGeometry2Effect(a).propertyIndex,R.scaleTogether().setValue(!1)}var m,g=function(t,e){try{t.timeRemap.removeKey(e)}catch(t){}},L=0;if(i.timeRemap.value||i.timeRemap2.value||i.pingpong.value){if(!a.canSetTimeRemapEnabled)throw new G;a.timeRemapEnabled=!0,L=a.timeRemap.valueAtTime(a.inPoint,!1),g(a,2),a.timeRemap.expressionEnabled=!1}if(!r)a.outPoint=p();var S=this.getBasePitch();if(i.tuning.value){if(!a.hasAudio)throw new U;if((m=a.duplicate()).enabled=!1,m.moveAfter(a),m.timeRemapEnabled=!0,!(i.timeRemap.value||i.timeRemap2.value||i.pingpong.value))L=m.timeRemap.valueAtTime(a.inPoint,!1);g(m,2),m.startTime=c(),m.outPoint=p(),m.timeRemap.expressionEnabled=!1,a.audioEnabled=!1}var C=0,v=function(){return t.getEffects(a).property(C).property(2)};if(i.negative.value)C=t.getEffects(a).addProperty("ADBE Invert").propertyIndex,v().setValue(100);var N=0,y=z.NOTE_OFF,b=-1;this.dealNoteEvents(s,e,l,L,(function(t){var e,o;if(!(t.sofarTick<=b)||y===z.NOTE_OFF&&t instanceof ct){var s=t.sofarTick*l+u;if(t instanceof ct){if(0===t.interruptDuration||0===t.duration||+t.interruptDuration<0||+t.duration<0)return;var c=void 0!==t.interruptDuration||void 0!==t.duration,p=null!==(o=null!==(e=t.interruptDuration)&&void 0!==e?e:t.duration)&&void 0!==o?o:0,d=(t.sofarTick+p)*l-dt+u;if(i.hFlip.value){var T=function(t){return!E?a.scale.addKey(t):(R.scaleHeight().addKey(t),R.scaleWidth().addKey(t))},g=function(t,e){return!E?a.scale.setValueAtKey(t,e):(R.scaleHeight().setValueAtKey(t,e[1]),R.scaleWidth().setValueAtKey(t,e[0]))},C=function(t,e){return!E?a.scale.setInterpolationTypeAtKey(t,e):(R.scaleHeight().setInterpolationTypeAtKey(t,e),R.scaleWidth().setInterpolationTypeAtKey(t,e))},A=function(t,e,i){return!E?n.setPointKeyEase(a.scale,t,e,i):(n.setPointKeyEase(R.scaleHeight(),t,e,i),n.setPointKeyEase(R.scaleWidth(),t,e,i))},I=T(s),w=N%2?-100:100;if(!f||!c)g(I,[w,100]),C(I,KeyframeInterpolationType.HOLD);else{g(I,[w+15*Math.sign(w),115]),C(I,KeyframeInterpolationType.LINEAR),g(D=T(d),[w,100]),A(D,J.EASE_IN,!0)}}if(i.cwRotation.value||i.ccwRotation.value){T=function(t){return!E?a.rotation.addKey(t):R.rotation().addKey(t)},g=function(t,e){return!E?a.rotation.setValueAtKey(t,e):R.rotation().setValueAtKey(t,e)},C=function(t,e){return!E?a.rotation.setInterpolationTypeAtKey(t,e):R.rotation().setInterpolationTypeAtKey(t,e)},A=function(t,e,i){return!E?n.setPointKeyEase(a.rotation,t,e,i):n.setPointKeyEase(R.rotation(),t,e,i)};var P=i.cwRotation.value?N%4*90:(4-N%4)%4*90;I=T(s);if(!f||!c)g(I,P),C(I,KeyframeInterpolationType.HOLD);else{g(I,P+15*(i.cwRotation.value?-1:1)),C(I,KeyframeInterpolationType.LINEAR),g(D=T(d),P),A(D,J.EASE_IN,!0)}}if(i.timeRemap.value||i.timeRemap2.value||i.pingpong.value){I=a.timeRemap.addKey(s);var k=!(N%2);if(a.timeRemap.setValueAtKey(I,L),c){var D=a.timeRemap.addKey(d),B=i.timeRemap.value||i.pingpong.value?L+O:d-s+L,M=i.pingpong.value&&!k;if(M)a.timeRemap.setValueAtKey(I,B);if(B<a.source.duration)a.timeRemap.setValueAtKey(D,!M?B:L);else a.timeRemap.removeKey(D),D=a.timeRemap.addKey(s+_-L),a.timeRemap.setValueAtKey(D,_)}}if(i.negative.value){I=v().addKey(s);v().setValueAtKey(I,N%2?0:100),v().setInterpolationTypeAtKey(I,KeyframeInterpolationType.HOLD)}if(i.tuning.value&&m){I=m.timeRemap.addKey(s);if(m.timeRemap.setValueAtKey(I,L),c){D=m.timeRemap.addKey(d);var F=d-s,x=t.pitch-S,G=Math.pow(2,x/12);if((B=F*G+L)<a.source.duration)m.timeRemap.setValueAtKey(D,B);else m.timeRemap.removeKey(D),D=m.timeRemap.addKey(s+(_-L)/G),m.timeRemap.setValueAtKey(D,_)}}if(h&&0!==N){if(!r)a=n.splitLayer(a,s);if(i.tuning.value&&m)m=n.splitLayer(m,s)}N++,y=z.NOTE_ON,b=t.sofarTick}}}))},t.prototype.applyEase100Percent=function(t){app.beginUndoGroup("om midi - Apply Easing 100%");for(var e=this.portal.toolsTab.ease.getValue(),n=0,i=t.selectedLayers;n<i.length;n++){var r=i[n];if(void 0!==r)for(var o=0,a=r.selectedProperties;o<a.length;o++){var l=a[o];if(void 0!==l)for(var s=0,u=l.selectedKeys;s<u.length;s++){var c=u[s];if(void 0!==c)this.setPointKeyEase(l,c,e,!1)}}}},t.prototype.createNullLayer=function(t){var e;t:for(;;){var n=!1;try{n=!!this.nullSource&&!!this.nullSource.parentFolder}catch(t){n=!1}if(n)(e=t.layers.add(this.nullSource,t.workAreaDuration)).opacity.setValue(0),e.anchorPoint.setValue([0,0]);else{for(var i=(e=t.layers.addNull(t.workAreaDuration)).source,r=1;r<=i.parentFolder.items.length;r++){var o=i.parentFolder.items[r];if(o.name===_t&&o instanceof FootageItem&&o.mainSource instanceof SolidSource){this.nullSource=o,i.remove();continue t}}this.nullSource=i,e.source.name=_t}break}return e.enabled=!1,e},t.getEffects=function(t){return t("Effects")},t.prototype.addSliderControl=function(e,n){var i=t.getEffects(e).addProperty("ADBE Slider Control");return i.name=n,i.propertyIndex},t.prototype.setValueAtTime=function(e,n,i,r,o,a,l){if(void 0===l)l=a;var s=n.indexOf(i);if(-1!==s){var u=t.getEffects(e).property(s+1).property(1),c=u.addKey(r);u.setValueAtKey(c,o),u.setInterpolationTypeAtKey(c,a,l)}},t.prototype.getSelectLayer=function(t){if(0===t.selectedLayers.length)return null;var e=t.selectedLayers[0];if(e instanceof AVLayer)return e;else return null},t.prototype.getSecondsPerTick=function(){if(!this.portal.midi)throw new D;var t,e=this.portal.midi.timeDivision;if(e instanceof Array)t=1/e[0]/e[1];else{t=60/parseFloat(this.portal.selectBpmTxt.text)/e}return t},t.prototype.getStartTime=function(t){var e=this.portal.startTimeCombo.getSelectedIndex();if(0===e)return t.displayStartTime;else if(1===e)return t.time;else if(2===e)return t.workAreaStart;else return 0},t.prototype.dealNoteEvents=function(t,e,n,i,r){if(void 0!==t)for(var o=0,a=t.events;o<a.length;o++){r(a[o])}else for(var l=0;l*n<=i+e.duration;)r(new ct(60,100,+!!l,1,l++))},t.prototype.getBasePitch=function(){var t=this.portal.applyEffectsTab;return 12*t.basePitchOctCombo.getSelectedIndex()+t.basePitchKeyCombo.getSelectedIndex()},t.prototype.splitLayer=function(t,e){var n=t.outPoint,i=t.duplicate();return t.outPoint=e,i.inPoint=e,i.outPoint=n,i},t.prototype.setPointKeyEase=function(t,e,n,i){for(var r=t.keyInTemporalEase(e).length,o=[],a=0;a<r;a++)o.push(new KeyframeEase(0,100));if(0!==o.length)t.setTemporalEaseAtKey(e,o);var l=i?KeyframeInterpolationType.HOLD:KeyframeInterpolationType.LINEAR;if(n===J.EASE_IN)t.setInterpolationTypeAtKey(e,KeyframeInterpolationType.BEZIER,l);else if(n===J.EASE_OUT)t.setInterpolationTypeAtKey(e,l,KeyframeInterpolationType.BEZIER)},t.prototype.getGeometry2Effect=function(e){for(var n="ADBE Geometry2",i=t.getEffects(e),r=1;r<=i.numProperties;r++){var o=i.property(r);if(o.name===Ot&&o.matchName===n)return o}var a=i.addProperty(n);return a.name=Ot,a},t}();!function(t){t[t.EASE_IN=0]="EASE_IN",t[t.EASE_OUT=1]="EASE_OUT",t[t.EASE_IN_OUT=2]="EASE_IN_OUT"}(J||(J={}));var Rt=function(t){function e(e){var n=t.call(this,e)||this;return n.easeInRadio=i(n.group,"radiobutton",{text:"缓入",value:!0}),n.easeOutRadio=i(n.group,"radiobutton",{text:"缓出"}),n.easeInOutRadio=i(n.group,"radiobutton",{text:"缓入缓出"}),n}return l(e,t),e.prototype.getValue=function(){if(this.easeInOutRadio.value)return J.EASE_IN_OUT;else if(this.easeOutRadio.value)return J.EASE_OUT;else return J.EASE_IN},e}(m),mt=function(t){function e(e){var n=t.call(this,e,void 0,{orientation:"column",alignment:"fill",alignChildren:"fill",margins:[10,5,0,0]})||this;return n.toolsCombo=i(n.group,"dropdownlist"),r(n.toolsCombo,"标记指挥官","缓动百分百"),n.toolsCombo.selection=W.getLastTool(),n.separator=new L(n.group,"horizontal"),n.toolsPanel=i(n.group,"group",{orientation:"stack",alignment:"fill",alignChildren:"fill"}),n.marker=new g(n),n.ease=new Rt(n),n.toolsCombo.onChange=function(){for(var t=n.toolsCombo.getSelectedIndex(),e=0;e<n.toolsPanel.children.length;e++){n.toolsPanel.children[e].visible=e===t}W.setLastTool(n.toolsCombo.getSelectedIndex())},n.toolsCombo.notify("onChange"),n}return l(e,t),e.prototype.getSelectedTool=function(){switch(this.toolsCombo.getSelectedIndex()){case 0:return this.marker;case 1:return this.ease;default:return null}},e.prototype.translate=function(){this.tab.text=localize(h.tools)},e}(_),gt=function(t){function e(e){return t.call(this,Folder.temp.fsName+"/"+e)||this}return l(e,t),e}(File);function Lt(t){var e;if(-1!==$.os.indexOf("Win"))e="explorer.exe "+t;else e="open "+t;try{system.callSystem(e)}catch(t){}}var St=function(){function t(){if(this.window=new Window("dialog","在表达式顶部添加",void 0,{resizeable:!1}),null===this.window)throw new C;this.group=i(this.window,"group",{orientation:"column",alignChildren:"fill",alignment:"fill"}),i(this.group,"statictext",{text:"若放置在 aep 工程的相同目录下"}),i(this.group,"edittext",{text:'$.evalFile(thisProject.fullPath.replace(/\\\\[^\\\\]*$/, "/om_utils.jsx"));'},{readonly:!0}),i(this.group,"statictext",{text:"若放置在任意位置，然后添加到 AE 项目中"}),i(this.group,"edittext",{text:'footage("om_utils.jsx").sourceData;'},{readonly:!0}),this.okBtn=i(this.group,"button",{text:localize(h.ok),alignment:"right"}),this.window.defaultElement=this.okBtn}return t.prototype.showDialog=function(){this.window.center(),this.window.show()},t}();var Ct=function(t){function e(e){var n=t.call(this)||this;return n.file=e,n}return l(e,t),e.prototype.getPointer=function(){return this.file.tell()},e.prototype.length=function(){return this.file.length},e.prototype.readByte=function(t){if(void 0===t)t=1;for(var e=this.file.read(t),n=0,i=0;i<e.length;i++)n<<=8,n+=e.charCodeAt(i);return n},e.prototype.readString=function(t){return this.file.read(t)},e.prototype.readByteArray=function(t){for(var e=this.file.read(t),n=[],i=0;i<e.length;i++)n.push(e.charCodeAt(i));return n},e.prototype.readDeltaTime=function(){for(var t=0,e=!1;!this.isReadOver()&&!e;){t<<=7;var n=this.file.read(1).charCodeAt(0);if(!(128&n))e=!0;t+=127&n}return t},e.prototype.isReadOver=function(){return this.file.eof},e.prototype.movePointer=function(t){this.file.seek(t,1)},e.prototype.setPointer=function(t){if(t<0||t>=this.length())return!1;else return this.file.seek(t,0)},e}((function(){})),vt=function(){function t(t,e,n){this.events=[],this.noteCount=0,this.lengthTick=0,this.splice=[].splice,this.parent=t,this.offset=e,this.size=n,this.readNotes()}return t.prototype.length=function(){return this.events.length},t.prototype.setName=function(t){var e;null!==(e=this.name)&&void 0!==e||(this.name=t)},t.prototype.setInstrument=function(t){var e;null!==(e=this.instrument)&&void 0!==e||(this.instrument=t)},t.prototype.setChannel=function(t){var e;null!==(e=this.channel)&&void 0!==e||(this.channel=t)},t.prototype.setTempo=function(t){var e,n,i;null!==(e=this.tempo)&&void 0!==e||(this.tempo=t),null!==(n=(i=this.parent.midi).bpm)&&void 0!==n||(i.bpm=this.bpm())},t.prototype.bpm=function(){if(void 0!==this.tempo){var t=6e7/this.tempo;return parseFloat(t.toFixed(2))}},t.prototype.push=function(t){this.events.push(t)},t.prototype.readNotes=function(){for(var t,e=this.offset+this.size,n=[];!(this.parent.isReadOver()||this.parent.getPointer()>=e);){var i=this.parent.readDeltaTime(),r=this.lengthTick+=i,o=t;if(-1===(t=this.parent.readByte(1)))break;else if(!(128&t))t=o,this.parent.movePointer(-1);var a=null;if(255===t){var l=this.parent.readByte(1),s=this.parent.readDeltaTime();switch(l){case H.END_OF_TRACK:if(this.parent.getPointer()!==e)new x(e,this.parent.getPointer());case H.END_OF_FILE:return;case H.TEXT_EVENT:case H.COPYRIGHT_NOTICE:case H.TRACK_NAME:case H.INSTRUMENT_NAME:case H.LYRICS:case H.MARKER:case H.CUE_POINT:var u=this.parent.readString(s);if(a=new it(l,u),l===H.TRACK_NAME)this.setName(u);else if(l===H.INSTRUMENT_NAME)this.setInstrument(u);break;case H.MIDI_PORT:case H.MIDI_PORT_2:case H.KEY_SIGNATURE:case H.SET_TEMPO:var c=this.parent.readByte(s);if(a=new rt(l,c),l===H.SET_TEMPO)this.setTempo(c);break;case H.SMPTE_OFFSET:var p=this.parent.readByteArray(s);a=new ot(p);break;case H.TIME_SIGNATURE:var h=this.parent.readByteArray(s);a=new at(h);break;default:var f=this.parent.readByteArray(s);a=new lt(l,f)}}else{this.setChannel(1+(15&t));var E=t>>4;switch(E){case z.NOTE_AFTERTOUCH:case z.CONTROLLER:case z.PITCH_BEND_EVENT:case z.NOTE_OFF:case z.NOTE_ON:var d=this.parent.readByteArray(2);switch(E){case z.NOTE_ON:var _=a=new ct(d);this.noteCount++;for(var O=0,T=n;O<T.length;O++){var R=T[O];if(void 0===R.interruptDuration)if(r<=R.sofarTick)_.interruptDuration=0;else R.interruptDuration=r-R.sofarTick}n.push(_);break;case z.NOTE_OFF:for(var m=a=new pt(d),g=n.length-1;g>=0;g--){var L=n[g];if(L.pitch===m.pitch){L.duration=r-L.sofarTick,L.noteOff=m,m.noteOn=L,n.splice(g,1);break}}break;case z.CONTROLLER:a=new ft(d);break;case z.PITCH_BEND_EVENT:a=new Et(d);break;case z.NOTE_AFTERTOUCH:default:a=new st(E,d)}break;case z.PROGRAM_CHANGE:case z.CHANNEL_AFTERTOUCH:var S=this.parent.readByteArray(1);a=new st(E,S);break;case z.END_OF_FILE:return;case z.SYSTEM_EXCLUSIVE_EVENTS:var C=this.parent.readDeltaTime();a=new ht(this.parent.readByteArray(C));break;default:throw new A}}if(null!==a)a.deltaTime=i,a.sofarTick=r,this.push(a)}},t.prototype.toString=function(){var t,e=localize(h.channel_abbr)+" "+(null!==(t=this.channel)&&void 0!==t?t:0);if(this.name)e+=": "+this.name;return e+=" ("+this.noteCount+")"},t.prototype.getPointer=function(){return this.parent.getPointer()},t}(),Nt=function(t){function e(e){var n=t.call(this,e.file)||this;return n.midi=e,n.readHeader(),n.readTracks(),n}return l(e,t),e.prototype.readHeader=function(){if(1297377380!==this.readByte(4))throw new y;this.readByte(4),this.midi.formatType=this.readByte(2),this.midi.trackCount=this.readByte(2);var t=this.readByte(1),e=this.readByte(1);if(128&t)this.midi.timeDivision=[127&t,e];else this.midi.timeDivision=(t<<8)+e},e.prototype.readTracks=function(){for(;!this.isReadOver();){var t=this.readByte(4);if(-1===t)break;if(1297379947!==t)throw new b;var e=this.readByte(4),n=new vt(this,this.getPointer(),e);this.midi.tracks.push(n)}},e}(Ct),yt=function(){function t(t){if(this.formatType=tt.SYNC_MULTI_TRACK,this.trackCount=0,this.timeDivision=0,this.tracks=[],this.preferredTrackIndex=0,this.isPureQuarter=!1,!0===t)return this.isPureQuarter=!0,this.formatType=tt.SINGLE_TRACK,this.trackCount=1,void(this.timeDivision=1);if(this.file=t,t&&t.open("r"))t.encoding="binary",this.length=t.length,this.midiReader=new Nt(this),t.close(),this.removeNotNoteTrack(),this.setPreferredTrack(),this.convertTracksNameEncoding();else throw new N}return t.prototype.removeNotNoteTrack=function(){for(var t=this.tracks.length-1;t>=0;t--){if(0===this.tracks[t].noteCount)this.tracks.splice(t,1)}},t.prototype.setPreferredTrack=function(){for(var t=0;t<this.tracks.length;t++){if(10!==this.tracks[t].channel){this.preferredTrackIndex=t;break}}},t.prototype.convertTracksNameEncoding=function(){for(var t=[],e=[],n=0,i=this.tracks;n<i.length;n++){if((o=i[n]).name)t.push(o),e.push(o.name)}if(0!==e.length){e=function(t){if("string"==typeof t)t=[t];if(0===t.length)return[];var e,n=new gt("tmp"+(new Date).valueOf()+".txt");if(n&&n.open("w")){e=n.encoding,n.encoding="binary";for(var i=0,r=t;i<r.length;i++){var o=r[i];n.writeln(o)}n.close()}else throw new P;var a=[];if(n&&n.open("r")){for(n.encoding=e;!n.eof;)a.push(n.readln());n.close(),n.remove()}else throw new P;return a}(e);for(var r=0;r<t.length&&r<e.length;r++){var o=t[r],a=e[r].trim();if(""==a)a=void 0;o.name=a}}},t}(),bt=function(){function t(t,e,n){if(void 0===n)n="fill";this.parent=t,this.outerGroup=i(this.parent,"group",{orientation:"column",alignment:n,alignChildren:"fill"}),this.columns=e}return t.prototype.add=function(t,e,n){var r=this.outerGroup.children;if(0===r.length||r[r.length-1].children.length>=this.columns)this.addRow();return i((r=this.outerGroup.children)[r.length-1],t,e,n)},t.prototype.addRow=function(){i(this.outerGroup,"group",{orientation:"row",alignment:"fill",alignChildren:"left"})},t}(),At=function(){function t(n){var a,l=this;if(this.portal=n,this.window=new Window("dialog",localize(h.settings)+" - "+e.scriptName+" v"+e.version,void 0,{resizeable:!1}),null===this.window)throw new C;this.group=i(this.window,"group",{orientation:"row",alignChildren:"fill",alignment:"fill"}),this.leftGroup=i(this.group,"group",{orientation:"column",alignChildren:"fill",alignment:"fill"}),this.separator=new L(this.group,"vertical"),this.rightGroup=i(this.group,"group",{orientation:"column",alignChildren:"fill",alignment:"fill",spacing:5}),this.aboutLbl=i(this.leftGroup,"statictext",{text:"读取一个 MIDI 序列，并为当前合成添加一个或多个新图层，其中包含各个 MIDI 轨道的音高、力度和持续时间等滑块控件。\n\n脚本原作者：大卫·范·布林克 (omino)、Dora (NGDXW)、韩琦、家鳖大帝\n脚本作者：兰音\n仓库地址："},{multiline:!0,scrolling:!0}),this.openGithubBtnGroup=new bt(this.leftGroup,3,["fill","bottom"]),this.openGithubLatestBtn=this.openGithubBtnGroup.add("button",{text:"检查更新"}),this.openGithubPageBtn=this.openGithubBtnGroup.add("button",{text:"仓库地址"}),this.extendScriptEngineAboutBtn=this.openGithubBtnGroup.add("button",{text:"关于脚本引擎"}),this.importOmUtilsBtn=this.openGithubBtnGroup.add("button",{text:"导入 om utils"}),this.importPureQuarterMidiBtn=this.openGithubBtnGroup.add("button",{text:"导入纯四分 MIDI"}),this.generalPanel=this.addPanel(this.rightGroup,localize(h.general),[10,10,10,7]),a=o(this.generalPanel,localize(h.language),"dropdownlist"),this.languageGroup=a.group,this.languageLbl=a.label,this.languageCombo=a.control,r(this.languageCombo,localize(h.app_default),"简体中文","English","日本語");var s=W.getLanguage();if(s>0&&s<this.languageCombo.items.length)this.languageCombo.selection=s;this.nullObjPanel=this.addPanel(this.rightGroup,localize(h.create_null_object)),this.usingSelectedLayerName=i(this.nullObjPanel,"checkbox",{text:"使用选中图层名称而不是 MIDI 轨道名称"}),this.usingSelectedLayerName.value=W.getUsingSelectedLayerName(),this.normalizePanTo100=i(this.nullObjPanel,"checkbox",{text:"声像标准化到 -100 ~ 100。"}),this.normalizePanTo100.value=W.getNormalizePanTo100(),this.applyEffectsPanel=this.addPanel(this.rightGroup,localize(h.apply_effects)),this.usingLayering=i(this.applyEffectsPanel,"checkbox",{text:"冰鸠さくの特有图层叠叠乐方法。"}),this.usingLayering.value=W.getUsingLayering(),this.optimizeApplyEffects=i(this.applyEffectsPanel,"checkbox",{text:"优化部分效果动画。"}),this.optimizeApplyEffects.value=W.getOptimizeApplyEffects(),this.addToEffectTransform=i(this.applyEffectsPanel,"checkbox",{text:"将属性添加到效果中的变换中。"}),this.addToEffectTransform.value=W.getAddToEffectTransform(),this.buttonGroup=i(this.rightGroup,"group",{orientation:"row",alignment:["fill","bottom"],alignChildren:["right","center"]}),this.okBtn=i(this.buttonGroup,"button",{text:localize(h.ok)}),this.cancelBtn=i(this.buttonGroup,"button",{text:localize(h.cancel)}),this.window.defaultElement=this.okBtn,this.window.cancelElement=this.cancelBtn,this.okBtn.onClick=function(){W.setUsingSelectedLayerName(l.usingSelectedLayerName.value),W.setUsingLayering(l.usingLayering.value),W.setOptimizeApplyEffects(l.optimizeApplyEffects.value),W.setNormalizePanTo100(l.normalizePanTo100.value),W.setAddToEffectTransform(l.addToEffectTransform.value),W.setLanguage(l.languageCombo.getSelectedIndex()),$.locale=t.langIso[l.languageCombo.getSelectedIndex()],l.window.close()},this.openGithubPageBtn.onClick=function(){return Lt(e.githubPage)},this.openGithubLatestBtn.onClick=function(){return Lt(e.githubLatest)},this.importPureQuarterMidiBtn.onClick=function(){if(confirm("确定要导入纯四分音符 MIDI 文件吗？",!0,"导入纯四分 MIDI"))l.portal.midi=new yt(!0),l.portal.selectedTracks=[void 0],l.portal.selectMidiName.text="纯四分音符 MIDI",l.portal.selectTrackBtn.text="",l.portal.selectTrackBtn.enabled=!1,l.portal.selectBpmTxt.enabled=!0},this.importOmUtilsBtn.onClick=function(){return(new St).showDialog()},this.extendScriptEngineAboutBtn.onClick=function(){return $.about()}}return t.prototype.showDialog=function(){this.window.center(),this.window.show()},t.prototype.addPanel=function(t,e,n){if(void 0===n)n=[10,13,10,3];return i(t,"panel",{text:e,orientation:"column",alignChildren:"fill",alignment:"fill",spacing:2,margins:n})},t.langIso=["","zh_CN","en","ja"],t}(),It=function(){function t(t){var e=this;if(this.parent=t,this.window=new Window("dialog","选择 MIDI 轨道",void 0,{resizeable:!0}),null===this.window)throw new C;this.window.onResizing=this.window.onResize=function(){return e.window.layout.resize()},this.group=i(this.window,"group",{orientation:"column",alignChildren:"fill",alignment:["fill","fill"]}),this.selectAllCheck=i(this.group,"checkbox",{text:localize(h.select_all)}),this.trackList=i(this.group,"listbox",{alignment:["fill","fill"]},{multiselect:!0,numberOfColumns:4,showHeaders:!0,columnTitles:[localize(h.channel),localize(h.name),localize(h.note_count)],columnWidths:[50,225,75]}),this.trackList.size=[400,400],this.buttonGroup=i(this.group,"group",{orientation:"row",alignment:["fill","bottom"],alignChildren:["right","center"]}),this.okBtn=i(this.buttonGroup,"button",{text:localize(h.ok)}),this.cancelBtn=i(this.buttonGroup,"button",{text:localize(h.cancel)}),this.window.defaultElement=this.okBtn,this.window.cancelElement=this.cancelBtn,this.initMidiTracks(),this.selectAllCheck.onClick=function(){for(var t=e.selectAllCheck.value,n=0,i=e.trackList.items;n<i.length;n++){var r=i[n];r.checked=r.selected=t}},this.trackList.onChange=function(){return e.trackList_onChange()},this.okBtn.onClick=function(){var t;if(e.parent.midi){for(var n=[],i=0;i<e.trackList.items.length;i++){var r=e.trackList.items[i],o=e.parent.midi.tracks[i];if(r.checked)n.push(o)}var a="";if(0!==n.length){if(1===n.length)a=n[0].toString();else{for(var l=[],s=0,u=n;s<u.length;s++){o=u[s];var c=String(null!==(t=o.channel)&&void 0!==t?t:0);if(o.name)c+=": "+o.name;l.push(c)}a=l.join("; ")}e.parent.selectedTracks=n,e.parent.selectTrackBtn.text=a,e.window.close()}else alert("请至少选择一条轨道。",localize(h.warning))}else e.window.close()}}return t.prototype.showDialog=function(){this.window.center(),this.window.show()},t.prototype.initMidiTracks=function(){var t,e;if(this.parent.midi)for(var n=0,i=this.parent.midi.tracks;n<i.length;n++){var r=i[n],o=this.trackList.add("item",String(null!==(t=r.channel)&&void 0!==t?t:0));o.checked=this.parent.selectedTracks.includes(r),o.subItems[0].text=null!==(e=r.name)&&void 0!==e?e:"",o.subItems[1].text=r.noteCount}this.trackList_onChange(!0)},t.prototype.trackList_onChange=function(t){if(void 0===t)t=!1;for(var e=!0,n=0,i=this.trackList.items;n<i.length;n++){var r=i[n];if(!t)r.checked=r.selected;if(!r.checked)e=!1}this.selectAllCheck.value=e},t}(),wt=function(t){function e(n,i){if(void 0===i)i="tmp"+(new Date).valueOf()+".png";var r=t.call(this,i)||this;if(r&&r.open("w"))r.encoding="binary",r.write(e.base64Decode(n)),r.close();else throw new P;return r}return l(e,t),e.base64Decode=function(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n={RE_NON_ALPHA:new RegExp("[^"+e+"]"),RE_BAD_EQUALS:/\=([^=]|\=\=)/},i=t.length>>>0,r=[];if(i%4||n.RE_NON_ALPHA.test(t)||n.RE_BAD_EQUALS.test(t))throw Error("Invalid Base64 data");for(var o,a,l,s,u,c,p=0;p<i;){if(s=((l=(e.indexOf(t[p++])<<18)+(e.indexOf(t[p++])<<12)+((63&(o=e.indexOf(t[p++])))<<6)+(63&(a=e.indexOf(t[p++]))))&255<<16)>>16,u=64==o?-1:(65280&l)>>8,c=64==a?-1:255&l,r[r.length]=String.fromCharCode(s),0<=u)r[r.length]=String.fromCharCode(u);if(0<=c)r[r.length]=String.fromCharCode(c)}return t=r.join(""),r.length=0,t},e.settingIcon=function(){return new e("iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAEMklEQVRIib1WTUgjWRCudeemiK4N4iy6GjYHESHYZC8yvqcEVvxBUEQvUcQQzOYayDALe3IGc1ToGQysoBdJBvUQVi9BXoSAkDQEg+QQiBsRvXQiO8bAHpYsX6c7ZESduewWNP3yut6rqq/qq8o3jDH6Smk11G6/9kAsFqMXWAghnlTinPuIyCNJkgW/NU2DgY9E9EEIkXrmXHWBCCqVyqMPY0z2+XwVTdMqptzf31disViFMbb51DnjrH7/iy9E6Z6cnNQXGxsb+ttms9HQ0BBZrVY35zwghMg9d0HNAOe8GVAQEaCICiEAg9zT00Pn5+e0v78fxH46nQ7DQH9/P2WzWZlzDsjcRo4+CiHURw0Q0ZrX6/W0t7dTKpWCd6okSXJbWxudnp7iew5GOee5QqFgsVqt2PNLkhSem5ujpqYmOj4+9nPOXUKI32u3AivG2NutrS0d5cvLy9ob2OM9MzMDzFsNbP3hcLimg5zgMXUZY0nG2A9mDlCmrZIkFXd2dvSyCgQCqt1ul0dGRqhUKlEoFELluIhIMmCIEtH09PS0B1GYOpC6OwJE9BprGPB7vd618fFxWlhYwGXdxmWzRs03S5L0xoRBVVWKRqMwgpzIhg7Wfgg8Hxsbw953MICQw8lkUg/R5XIhxLd1pfYecACCeslkMiZsw4aeDWV7eHioa6G0UeJmDoahbOJpfPSZHICg7mEceuvr67oenIJzjLFmXA4dCByCY2YOvu3u7v6zXC5fHRwcfD8wMPByYmKCwuHwj8B7ZWVFBiwejydXLBZHyuXym0wm809LS8srh8NB8Xi8r1gs/uX1elE9wB75+AD8iejvfD5PDVRtFSirQDweJ5Sl0RZ0DpTLZajcoi0IIYBt6ubmRvcOXIAjcKJQKCA3qhDiFyHEp894wDlfBskGBwd1RU3TwE714uJC7uvr0y/hnNuIKA8yd3R06IfT6bRuHJXU2dlJDocDxHtvRPDJhGhYkqS9zc3Nl11dXbS6ukrX19fviGivVCq5p6amyGKxtF5dXa00NDT4R0dHX83Pz9PZ2Rnt7u6C7b8lEok2i8UiO51OamxstCcSiRYi+gMQ/edVBIjUXC4329vbS7e3eqsPcs4dRIQnryjKu1Ao9BQPfuac/2Ss9cPIWSKRwFo1DQRDoZBOtOXlZVTCHrCUZfkzJiuK8pDJ4Tomr5ltRydX1eD/04vMifYr5xzl5gEM29vbesmhm6K/AB5FUdCS0WPc6FNHR0d634IOvqMLRyIRMiZd3pxo9e36taIoeRMGIUSUc54sFAoyDmNOcM5n7Xa7BVzJZrPYC2iaFjWMgzvBJ+eBQY7Ag4FU48Li4qL77u7ObcwBkwMgFhL68NyjA+cxCUYiETcYvbS0VPt+cnKCCODts+PyiwYQLiaU0+nEv4pqd6z+s0CVoOc8L0T0L32CI0/szYESAAAAAElFTkSuQmCC","settings_icon.png")},e}(gt),Pt=function(){function t(t){var e,n,a,l,s=this;this.selectedTracks=[],this.window=t,this.group=i(this.window,"group",{orientation:"column",alignChildren:"fill",alignment:"fill",spacing:5});var u=["fill","center"];e=o(this.group,"MIDI 文件","button",{text:"...",size:[15,22]}),this.selectMidiGroup=e.group,this.selectMidiLbl=e.label,this.selectMidiBtn=e.control,this.selectMidiName=i(this.selectMidiGroup,"statictext",{text:"未选择",alignment:u}),n=o(this.group,"选择轨道","button",{text:"",alignment:u,maximumSize:[1e4,22],enabled:!1}),this.selectTrackGroup=n.group,this.selectTrackLbl=n.label,this.selectTrackBtn=n.control,a=o(this.group,"设定 BPM","edittext",{text:"120",alignment:u,enabled:!1}),this.selectBpmGroup=a.group,this.selectBpmLbl=a.label,this.selectBpmTxt=a.control,l=o(this.group,"开始位置","dropdownlist",{alignment:u}),this.startTimeGroup=l.group,this.startTimeLbl=l.label,this.startTimeCombo=l.control,r(this.startTimeCombo,"显示开始时间","当前时间","工作区域","0"),this.tabs=i(this.group,"tabbedpanel",{alignment:["fill","fill"]}),this.buttonGroup=i(this.group,"group",{orientation:"row",alignment:["fill","bottom"]}),this.applyBtn=i(this.buttonGroup,"button",{alignment:"left"});var c=wt.settingIcon();this.settingBtn=i(this.buttonGroup,"iconbutton",{alignment:["right","center"],image:c},{style:"toolbutton"}),c.remove(),this.nullObjTab=new O(this),this.applyEffectsTab=new T(this),this.toolsTab=new mt(this),this.translate(),this.core=new Tt(this),R(this.selectBpmTxt,E.POSITIVE_DECIMAL,120),this.selectMidiBtn.onClick=function(){var t,e=File.openDialog("选择一个 MIDI 序列","MIDI 序列:*.mid;*.midi,所有文件:*.*");if(null!==e){var n;try{if((n=new yt(e)).bpm)s.selectBpmTxt.text=String(n.bpm);if(0===n.tracks.length)throw new I;s.selectMidiName.text=e.displayName;var i=n.tracks[n.preferredTrackIndex];s.selectedTracks=[i],s.selectTrackBtn.text=i.toString(),s.selectTrackBtn.enabled=!0,s.selectBpmTxt.enabled=!0,s.midi=n}catch(e){if(n)null===(t=n.file)||void 0===t||t.close()}}},this.applyBtn.onClick=function(){return s.core.apply()},this.settingBtn.onClick=function(){var t;if(new At(s).showDialog(),null===(t=s.midi)||void 0===t?void 0:t.isPureQuarter)s.selectTrackBtn.enabled=!1;s.translate()},this.selectTrackBtn.onClick=function(){new It(s).showDialog()},this.tabs.onChange=function(){if(s.getSelectedTab()===s.applyEffectsTab)s.startTimeCombo.selection=W.getApplyEffectsStartTime();else s.startTimeCombo.selection=W.getNullObjectStartTime()},this.tabs.onChange(),this.startTimeCombo.onChange=function(){var t=s.getSelectedTab(),e=s.startTimeCombo.getSelectedIndex();if(t===s.applyEffectsTab)W.setApplyEffectsStartTime(e);else W.setNullObjectStartTime(e)}}return t.build=function(e,n){$.strict=!0;var i=e instanceof Panel?e:new Window("palette",n.scriptName+" v"+n.version,void 0,{resizeable:!0});if(null===i)throw new C;var r=new t(i);if(i instanceof Window)i.onResizing=i.onResize=function(){return i.layout.resize()},i.center(),i.show();else i.layout.layout(!0),i.layout.resize();return r},t.prototype.getSelectedTab=function(){if(null===this.tabs.selection)return null;switch(this.tabs.selection.text){case this.nullObjTab.tab.text:return this.nullObjTab;case this.applyEffectsTab.tab.text:return this.applyEffectsTab;case this.toolsTab.tab.text:return this.toolsTab;default:return null}},t.prototype.translate=function(){this.applyBtn.text=localize(h.apply),this.nullObjTab.translate(),this.applyEffectsTab.translate(),this.toolsTab.translate()},t}();if("aftereffects"!==BridgeTalk.appName)throw new w;else String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1},Array.prototype.includes=function(t){return-1!==this.indexOf(t)},DropDownList.prototype.getSelectedIndex=function(){for(var t=0;t<this.items.length;t++)if(this.items[t].selected)return t;return-1},Math.sign=function(t){if(t>0)return 1;else if(t<0)return-1;else return 0},Pt.build(t,e)}(this);
